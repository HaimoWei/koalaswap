server:
  port: 18080

app:
  cors:
    allowed-origins: "http://localhost:5173"   # 生产改成你的前端域名，可逗号分隔多个

spring:
  main:
    web-application-type: reactive

  cloud:
    gateway:
      # 全局 CORS（预检请求在网关直接处理）
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        add-to-simple-url-handler-mapping: true
        corsConfigurations:
          "[/**]":
            allowedOrigins: "${app.cors.allowed-origins}"
            allowedMethods: "*"
            allowedHeaders: "*"
            allowCredentials: true    # 只用 Bearer 不带 Cookie 可设 false

      routes:
        # users & auth 在同一个服务：用一条 Path 谓词，逗号分隔多个模式（注意 'Path=' 只能写一次）
        - id: users-and-auth
          uri: http://localhost:12649
          predicates:
            - Path=/api/users/**, /api/auth/**

        - id: products
          uri: http://localhost:12648
          predicates:
            - Path=/api/products/**

        - id: orders
          uri: http://localhost:12650
          predicates:
            - Path=/api/orders/**

        - id: reviews
          uri: http://localhost:12651
          predicates:
            - Path=/api/reviews/**

        - id: chat-http
          uri: http://localhost:12652
          predicates:
            - Path=/api/chat/**

        # WebSocket / SockJS 端点
        - id: chat-ws
          uri: http://localhost:12652   # 若握手失败可改成 ws://localhost:12652
          predicates:
            - Path=/ws/chat/**

management:
  endpoints:
    web:
      exposure:
        include: health,info
