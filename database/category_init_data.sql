-- =====================================================================
-- KoalaSwap 商品分类初始化数据 v1.0
-- 目标：为二手交易平台提供完整的3级分类体系
-- 兼容表结构：product_categories (id, name, parent_id)
-- =====================================================================

-- ⚠️  处理外键约束：先清除products表对旧分类的引用
UPDATE products SET category_id = NULL WHERE category_id IS NOT NULL;

-- 清空现有分类数据
DELETE FROM product_categories;

-- 重置序列起始值（PostgreSQL，避免ID冲突）
ALTER SEQUENCE product_categories_id_seq RESTART WITH 1000;

-- =====================================================================
-- 一级分类（顶级分类）
-- =====================================================================
INSERT INTO product_categories (id, name, parent_id) VALUES
(1000, '数码电子', NULL),
(2000, '生活用品', NULL),
(3000, '图书文娱', NULL),
(9000, '其他分类', NULL);

-- =====================================================================
-- 二级分类
-- =====================================================================
INSERT INTO product_categories (id, name, parent_id) VALUES
-- 数码电子的二级分类
(1001, '手机通讯', 1000),
(1002, '电脑办公', 1000),
(1003, '数码影音', 1000),
(1004, '家用电器', 1000),

-- 生活用品的二级分类
(2001, '服装鞋包', 2000),
(2002, '美妆个护', 2000),
(2003, '家居生活', 2000),
(2004, '运动户外', 2000),
(2005, '母婴用品', 2000),

-- 图书文娱的二级分类
(3001, '图书杂志', 3000),
(3002, '文体用品', 3000),
(3003, '游戏娱乐', 3000),

-- 其他分类的二级分类
(9001, '其他', 9000);

-- =====================================================================
-- 三级分类（具体商品类型）
-- =====================================================================
INSERT INTO product_categories (id, name, parent_id) VALUES
-- 手机通讯的三级分类
(1011, '智能手机', 1001),
(1012, '手机配件', 1001),
(1013, '对讲机', 1001),

-- 电脑办公的三级分类
(1021, '笔记本电脑', 1002),
(1022, '台式电脑', 1002),
(1023, '平板电脑', 1002),
(1024, '电脑配件', 1002),
(1025, '办公设备', 1002),

-- 数码影音的三级分类
(1031, '数码相机', 1003),
(1032, '摄像设备', 1003),
(1033, '耳机音响', 1003),
(1034, '智能手表', 1003),
(1035, '无人机', 1003),

-- 家用电器的三级分类
(1041, '大型家电', 1004),
(1042, '小型家电', 1004),
(1043, '厨房电器', 1004),

-- 服装鞋包的三级分类
(2011, '男装', 2001),
(2012, '女装', 2001),
(2013, '童装', 2001),
(2014, '男鞋', 2001),
(2015, '女鞋', 2001),
(2016, '箱包', 2001),
(2017, '配饰', 2001),

-- 美妆个护的三级分类
(2021, '护肤品', 2002),
(2022, '彩妆', 2002),
(2023, '香水', 2002),
(2024, '个人护理', 2002),

-- 家居生活的三级分类
(2031, '家具', 2003),
(2032, '家纺用品', 2003),
(2033, '厨房用品', 2003),
(2034, '收纳整理', 2003),
(2035, '装饰用品', 2003),

-- 运动户外的三级分类
(2041, '健身器材', 2004),
(2042, '运动服饰', 2004),
(2043, '户外用品', 2004),
(2044, '运动鞋', 2004),

-- 母婴用品的三级分类
(2051, '奶粉辅食', 2005),
(2052, '纸尿裤', 2005),
(2053, '婴儿用品', 2005),
(2054, '儿童玩具', 2005),

-- 图书杂志的三级分类
(3011, '小说文学', 3001),
(3012, '教育考试', 3001),
(3013, '科技计算机', 3001),
(3014, '生活时尚', 3001),
(3015, '杂志期刊', 3001),

-- 文体用品的三级分类
(3021, '文具用品', 3002),
(3022, '乐器', 3002),
(3023, '绘画用品', 3002),

-- 游戏娱乐的三级分类
(3031, '游戏机', 3003),
(3032, '游戏软件', 3003),
(3033, '桌游卡牌', 3003);

-- =====================================================================
-- 验证插入结果
-- =====================================================================
-- 查看分类树结构
SELECT
    CASE
        WHEN parent_id IS NULL THEN '一级: ' || name
        WHEN id IN (SELECT DISTINCT parent_id FROM product_categories WHERE parent_id IS NOT NULL) THEN '  二级: ' || name
        ELSE '    三级: ' || name
    END as category_tree,
    id,
    parent_id
FROM product_categories
ORDER BY id;

-- 统计各级分类数量
SELECT
    CASE
        WHEN parent_id IS NULL THEN '一级分类'
        WHEN id IN (SELECT DISTINCT parent_id FROM product_categories WHERE parent_id IS NOT NULL) THEN '二级分类'
        ELSE '三级分类'
    END as level,
    COUNT(*) as count
FROM product_categories
GROUP BY
    CASE
        WHEN parent_id IS NULL THEN '一级分类'
        WHEN id IN (SELECT DISTINCT parent_id FROM product_categories WHERE parent_id IS NOT NULL) THEN '二级分类'
        ELSE '三级分类'
    END
ORDER BY level;